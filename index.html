// ============================================
// STATE & DATA
// ============================================

const appState = {
    user: {
        name: "Rizki Pratama",
        email: "rizki.pratama@email.com",
        balance: 34500000,
        creditScore: 720,
        transactionsCount: 24,
        joined: "2024-01-15",
        isPremium: true
    },
    financialData: {
        income: 16500000,
        expense: 9983000,
        incomeBreakdown: {
            gaji: 15000000,
            bonus: 1000000,
            lainnya: 500000
        },
        expenseBreakdown: {
            sewa: 4500000,
            makanan: 2500000,
            transportasi: 1483000,
            lainnya: 1500000
        }
    },
    transactions: [
        { id: 1, type: "expense", desc: "Biaya Utilitas", category: "Utilitas", amount: 150000, date: "2024-11-28" },
        { id: 2, type: "income", desc: "Gaji", category: "Gaji", amount: 2500000, date: "2024-11-25" },
        { id: 3, type: "expense", desc: "Sewa", category: "Kebutuhan Pokok", amount: 1200000, date: "2024-11-20" },
        { id: 4, type: "expense", desc: "Belanja Harian", category: "Makanan", amount: 250000, date: "2024-11-19" }
    ],
    currentTab: 'bookkeeping',
    security: {
        encryption: true,
        biometric: false,
        twoFactor: true
    }
};

// ============================================
// CORE FUNCTIONS
// ============================================

function initApp() {
    updateTransactionList();
    updateBalance();
    setupEventListeners();
    showWelcomeToast();
}

function updateTransactionList() {
    const list = document.getElementById('transaction-list');
    if (!list) return;
    
    list.innerHTML = appState.transactions.map(trans => `
        <button onclick="showTransactionDetail(${trans.id})" 
                class="w-full bg-white p-4 rounded-xl shadow-sm flex justify-between items-center hover:shadow-md transition btn-press">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 ${trans.type === 'income' ? 'bg-green-100' : 'bg-red-100'} rounded-full flex items-center justify-center">
                    <i class="fa-solid ${trans.type === 'income' ? 'fa-arrow-down text-green-600' : 'fa-arrow-up text-red-600'}"></i>
                </div>
                <div>
                    <p class="font-bold text-gray-800 text-sm">${trans.desc}</p>
                    <p class="text-xs text-gray-400">${trans.category}</p>
                </div>
            </div>
            <span class="font-bold ${trans.type === 'income' ? 'text-green-600' : 'text-red-500'}">
                ${trans.type === 'income' ? '+' : '-'}Rp ${formatCurrency(trans.amount)}
            </span>
        </button>
    `).join('');
    
    document.getElementById('today-transactions').textContent = 
        appState.transactions.filter(t => t.date === new Date().toISOString().split('T')[0]).length;
}

function updateBalance() {
    const income = appState.transactions.filter(t => t.type === 'income')
                 .reduce((sum, t) => sum + t.amount, 0);
    const expense = appState.transactions.filter(t => t.type === 'expense')
                  .reduce((sum, t) => sum + t.amount, 0);
    const balance = income - expense;
    
    document.getElementById('current-balance').textContent = `Rp ${formatCurrency(balance)}`;
}

function formatCurrency(amount) {
    return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// ============================================
// TAB NAVIGATION
// ============================================

const tabs = ['bookkeeping', 'financial', 'credit', 'mentor', 'profile', 'security', 'menu'];

function switchTab(tabId) {
    // Hide all tabs
    tabs.forEach(tab => {
        const tabEl = document.getElementById(`tab-${tab}`);
        const navBtn = document.getElementById(`nav-${tab}`);
        if (tabEl) tabEl.classList.add('hidden');
        if (navBtn) {
            navBtn.querySelector('i').classList.remove('text-adamon-dark');
            navBtn.querySelector('i').classList.add('text-gray-400');
            navBtn.querySelector('span').classList.remove('text-adamon-dark');
            navBtn.querySelector('span').classList.add('text-gray-400');
        }
    });

    // Show selected tab
    const activeTab = document.getElementById(`tab-${tabId}`);
    const activeNavBtn = document.getElementById(`nav-${tabId}`);
    if (activeTab) {
        activeTab.classList.remove('hidden');
        activeTab.classList.add('fade-in');
        appState.currentTab = tabId;
    }
    if (activeNavBtn && ['bookkeeping', 'financial', 'credit', 'mentor', 'profile'].includes(tabId)) {
        activeNavBtn.querySelector('i').classList.remove('text-gray-400');
        activeNavBtn.querySelector('i').classList.add('text-adamon-dark');
        activeNavBtn.querySelector('span').classList.remove('text-gray-400');
        activeNavBtn.querySelector('span').classList.add('text-adamon-dark');
    }

    // Show/hide FAB
    const fab = document.getElementById('fab-add-transaction');
    if (tabId === 'bookkeeping') {
        fab.classList.remove('hidden');
        setTimeout(() => fab.style.opacity = '1', 10);
    } else {
        fab.style.opacity = '0';
        setTimeout(() => fab.classList.add('hidden'), 300);
    }
}

// ============================================
// MODAL SYSTEM
// ============================================

function showModal(title, content, options = {}) {
    const modalId = 'modal-' + Date.now();
    const modalHTML = `
        <div id="${modalId}" class="modal-overlay">
            <div class="bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-xl animate-scale">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">${title}</h3>
                    <button onclick="closeCurrentModal()" class="text-gray-400 hover:text-gray-600 btn-press">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="mb-6">${content}</div>
                <div class="flex gap-3">
                    ${options.confirm ? `
                        <button onclick="${options.confirmAction || 'closeCurrentModal()'}" 
                                class="flex-1 bg-adamon-dark text-white py-3 rounded-xl font-medium hover:bg-teal-900 transition btn-press">
                            ${options.confirmText || 'Ya'}
                        </button>
                        <button onclick="closeCurrentModal()" 
                                class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-50 transition btn-press">
                            ${options.cancelText || 'Batal'}
                        </button>
                    ` : `
                        <button onclick="closeCurrentModal()" 
                                class="w-full bg-adamon-dark text-white py-3 rounded-xl font-medium hover:bg-teal-900 transition btn-press">
                            Tutup
                        </button>
                    `}
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('modal-container').innerHTML = modalHTML;
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('hidden');
        setTimeout(() => modal.remove(), 300);
    }
}

// FUNGSI BARU: Close modal yang sedang aktif
function closeCurrentModal() {
    const modals = document.querySelectorAll('.modal-overlay');
    if (modals.length > 0) {
        const lastModal = modals[modals.length - 1];
        closeModal(lastModal.id);
    }
}

// ============================================
// TOAST SYSTEM
// ============================================

function showToast(message, type = 'info', duration = 3000) {
    const toastId = 'toast-' + Date.now();
    const icons = {
        success: 'fa-circle-check',
        error: 'fa-circle-xmark',
        warning: 'fa-triangle-exclamation',
        info: 'fa-circle-info'
    };
    const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
    };
    
    const toastHTML = `
        <div id="${toastId}" class="toast ${colors[type]} text-white p-4 rounded-xl shadow-lg flex items-center gap-3">
            <i class="fa-solid ${icons[type]}"></i>
            <div class="flex-1">
                <p class="font-medium">${message}</p>
            </div>
            <button onclick="closeToast('${toastId}')" class="text-white/80 hover:text-white">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
    `;
    
    const container = document.getElementById('toast-container');
    container.insertAdjacentHTML('beforeend', toastHTML);
    
    setTimeout(() => closeToast(toastId), duration);
}

function closeToast(toastId) {
    const toast = document.getElementById(toastId);
    if (toast) {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => toast.remove(), 300);
    }
}

function showWelcomeToast() {
    setTimeout(() => {
        showToast('Selamat datang di Adamon!', 'success');
    }, 1000);
}

// ============================================
// FUNGSI TAMBAH PEMASUKAN & PENGELUARAN BARU
// ============================================

function showAddIncomeForm() {
    showModal('Tambah Pemasukan', `
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                <input type="text" id="income-desc" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent" placeholder="Contoh: Gaji bulanan">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah (Rp)</label>
                <input type="number" id="income-amount" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent" placeholder="0">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                <select id="income-category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent">
                    <option value="Gaji">Gaji</option>
                    <option value="Bonus">Bonus</option>
                    <option value="Investasi">Investasi</option>
                    <option value="Freelance">Freelance</option>
                    <option value="Hadiah">Hadiah</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                <input type="date" id="income-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent" value="${new Date().toISOString().split('T')[0]}">
            </div>
            
            <div class="flex gap-3">
                <button onclick="saveIncomeTransaction()" class="flex-1 bg-adamon-dark text-white py-3 rounded-xl font-medium hover:bg-teal-900 transition btn-press">
                    Simpan
                </button>
                <button onclick="closeCurrentModal()" class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-50 transition btn-press">
                    Batal
                </button>
            </div>
        </div>
    `);
}

function showAddExpenseForm() {
    showModal('Tambah Pengeluaran', `
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                <input type="text" id="expense-desc" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent" placeholder="Contoh: Belanja bulanan">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah (Rp)</label>
                <input type="number" id="expense-amount" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent" placeholder="0">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                <select id="expense-category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent">
                    <option value="Makanan">Makanan & Minuman</option>
                    <option value="Transportasi">Transportasi</option>
                    <option value="Belanja">Belanja</option>
                    <option value="Hiburan">Hiburan</option>
                    <option value="Kesehatan">Kesehatan</option>
                    <option value="Pendidikan">Pendidikan</option>
                    <option value="Tagihan">Tagihan & Utilitas</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                <input type="date" id="expense-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-adamon-dark focus:border-transparent" value="${new Date().toISOString().split('T')[0]}">
            </div>
            
            <div class="flex gap-3">
                <button onclick="saveExpenseTransaction()" class="flex-1 bg-adamon-dark text-white py-3 rounded-xl font-medium hover:bg-teal-900 transition btn-press">
                    Simpan
                </button>
                <button onclick="closeCurrentModal()" class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-50 transition btn-press">
                    Batal
                </button>
            </div>
        </div>
    `);
}

function saveIncomeTransaction() {
    const desc = document.getElementById('income-desc').value.trim();
    const amount = parseInt(document.getElementById('income-amount').value) || 0;
    const category = document.getElementById('income-category').value;
    const date = document.getElementById('income-date').value;
    
    if (!desc) {
        showToast('Deskripsi tidak boleh kosong', 'error');
        return;
    }
    
    if (amount <= 0) {
        showToast('Jumlah harus lebih dari 0', 'error');
        return;
    }
    
    const newTrans = {
        id: Date.now(),
        type: "income",
        desc: desc,
        category: category,
        amount: amount,
        date: date
    };
    
    appState.transactions.unshift(newTrans);
    updateTransactionList();
    
    // Update income data
    appState.financialData.income += amount;
    if (category === 'Gaji') {
        appState.financialData.incomeBreakdown.gaji += amount;
    } else if (category === 'Bonus') {
        appState.financialData.incomeBreakdown.bonus += amount;
    } else {
        appState.financialData.incomeBreakdown.lainnya += amount;
    }
    
    // Update user balance
    appState.user.balance += amount;
    
    // Update display
    updateBalance();
    
    closeCurrentModal();
    showToast('Pemasukan berhasil ditambahkan! ðŸŽ‰', 'success');
}

function saveExpenseTransaction() {
    const desc = document.getElementById('expense-desc').value.trim();
    const amount = parseInt(document.getElementById('expense-amount').value) || 0;
    const category = document.getElementById('expense-category').value;
    const date = document.getElementById('expense-date').value;
    
    if (!desc) {
        showToast('Deskripsi tidak boleh kosong', 'error');
        return;
    }
    
    if (amount <= 0) {
        showToast('Jumlah harus lebih dari 0', 'error');
        return;
    }
    
    const newTrans = {
        id: Date.now(),
        type: "expense",
        desc: desc,
        category: category,
        amount: amount,
        date: date
    };
    
    appState.transactions.unshift(newTrans);
    updateTransactionList();
    
    // Update expense data
    appState.financialData.expense += amount;
    if (category === 'Makanan') {
        appState.financialData.expenseBreakdown.makanan += amount;
    } else if (category === 'Transportasi') {
        appState.financialData.expenseBreakdown.transportasi += amount;
    } else if (category === 'Tagihan') {
        appState.financialData.expenseBreakdown.sewa += amount;
    } else {
        appState.financialData.expenseBreakdown.lainnya += amount;
    }
    
    // Update user balance
    appState.user.balance -= amount;
    
    // Update display
    updateBalance();
    
    closeCurrentModal();
    showToast('Pengeluaran berhasil dicatat! ðŸ’°', 'success');
}

// ============================================
// FUNGSI UNTUK TOMBOL "Tambah Pemasukan" & "Tambah Pengeluaran"
// ============================================

function quickAddTransaction(type) {
    if (type === 'income') {
        showAddIncomeForm();
    } else if (type === 'expense') {
        showAddExpenseForm();
    }
}

// ============================================
// FUNGSI LAINNYA YANG SUDAH ADA (DIPERBAIKI)
// ============================================

function showQuickAddMenu() {
    showModal('Tambah Cepat', `
        <div class="space-y-3">
            <button onclick="showAddIncomeForm()" class="w-full bg-green-50 border border-green-200 p-4 rounded-xl flex items-center justify-between btn-press hover:bg-green-100">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-money-bill-wave text-green-600"></i>
                    <span>Tambah Pemasukan</span>
                </div>
                <i class="fa-solid fa-plus text-green-600"></i>
            </button>
            <button onclick="showAddExpenseForm()" class="w-full bg-red-50 border border-red-200 p-4 rounded-xl flex items-center justify-between btn-press hover:bg-red-100">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-utensils text-red-600"></i>
                    <span>Tambah Pengeluaran</span>
                </div>
                <i class="fa-solid fa-plus text-red-600"></i>
            </button>
            <button onclick="showTransferForm()" class="w-full bg-blue-50 border border-blue-200 p-4 rounded-xl flex items-center justify-between btn-press hover:bg-blue-100">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-arrow-right-arrow-left text-blue-600"></i>
                    <span>Catat Transfer</span>
                </div>
                <i class="fa-solid fa-plus text-blue-600"></i>
            </button>
        </div>
    `);
}

function showTransferForm() {
    showModal('Catat Transfer', `
        <div class="space-y-4">
            <p class="text-gray-600 text-sm">Fitur transfer antar rekening akan segera hadir di update berikutnya!</p>
            <button onclick="closeCurrentModal()" class="w-full bg-adamon-dark text-white py-3 rounded-xl font-medium hover:bg-teal-900 transition btn-press">
                OK, Mengerti
            </button>
        </div>
    `);
}

// ============================================
// FUNGSI PREMIUM YANG SUDAH DIPERBAIKI
// ============================================

function showPremiumModal() {
    showModal('Fitur Premium Adamon', `
        <div class="space-y-6">
            <div class="text-center">
                <div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                    <i class="fa-solid fa-crown text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800">Upgrade ke Premium</h3>
                <p class="text-sm text-gray-600 mt-1">Buka semua fitur eksklusif untuk manajemen keuangan yang lebih baik</p>
            </div>
            
            <div class="space-y-4">
                <!-- Fitur Premium 1 -->
                <div class="flex items-start gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-robot text-blue-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-800">Analisis AI Lanjutan</p>
                        <p class="text-xs text-gray-600">Prediksi keuangan & rekomendasi investasi personal</p>
                    </div>
                </div>
                
                <!-- Fitur Premium 2 -->
                <div class="flex items-start gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-file-export text-green-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-800">Ekspor Data Unlimited</p>
                        <p class="text-xs text-gray-600">Ekspor laporan ke PDF, Excel tanpa batas</p>
                    </div>
                </div>
                
                <!-- Fitur Premium 3 -->
                <div class="flex items-start gap-3 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-headset text-purple-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-800">Dukungan Prioritas</p>
                        <p class="text-xs text-gray-600">Akses langsung ke spesialis keuangan 24/7</p>
                    </div>
                </div>
            </div>
            
            <!-- Harga -->
            <div class="bg-gradient-to-r from-adamon-dark to-teal-700 p-4 rounded-xl text-white text-center shadow-md">
                <p class="text-sm opacity-90 mb-1">Harga Spesial</p>
                <p class="text-3xl font-bold">Rp 49.999<span class="text-lg">/bulan</span></p>
                <p class="text-xs opacity-80 mt-1">Atau Rp 499.999/tahun (hemat 16%)</p>
            </div>
            
            <!-- Tombol Aksi -->
            <div class="space-y-3">
                <button onclick="subscribePremium()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-400 text-adamon-dark py-3 rounded-xl font-bold hover:from-yellow-500 hover:to-orange-500 transition flex items-center justify-center gap-2 btn-press shadow-lg">
                    <i class="fa-solid fa-crown"></i>
                    Upgrade Sekarang
                </button>
                
                <!-- TOMBOL INI SUDAH DIPERBAIKI -->
                <button onclick="closeCurrentModal()" class="w-full text-sm text-gray-500 hover:text-gray-700 transition btn-press">
                    Nanti Saja
                </button>
            </div>
            
            <!-- Info Tambahan -->
            <div class="pt-4 border-t border-gray-200">
                <p class="text-xs text-center text-gray-500">âœ… 30 hari garansi uang kembali â€¢ ðŸ”’ Pembayaran aman â€¢ ðŸ“± Bisa diakses di semua perangkat</p>
            </div>
        </div>
    `);
}

function subscribePremium() {
    showToast('Mengarahkan ke halaman pembayaran...', 'info');
    
    // Tutup modal premium
    closeCurrentModal();
    
    // Simulasi proses pembayaran
    setTimeout(() => {
        const success = Math.random() > 0.2; // 80% success rate
        
        if (success) {
            appState.user.isPremium = true;
            showToast('ðŸŽ‰ Berlangganan premium berhasil! Fitur premium sudah aktif.', 'success');
            
            // Update UI untuk menandakan premium
            const premiumBadge = document.querySelector('.bg-gradient-to-r.from-yellow-400.to-orange-400');
            if (premiumBadge) {
                premiumBadge.innerHTML = '<i class="fa-solid fa-crown"></i> <span>PRO</span>';
                premiumBadge.classList.add('animate-pulse');
                setTimeout(() => {
                    premiumBadge.classList.remove('animate-pulse');
                }, 2000);
            }
        } else {
            showToast('Pembayaran gagal. Silakan coba lagi.', 'error');
        }
    }, 1500);
}

// ============================================
// FUNGSI BANTU LAINNYA (DISEDERHANAKAN)
// ============================================

function showTransactionDetail(id) {
    const trans = appState.transactions.find(t => t.id === id);
    if (!trans) return;
    
    showModal(`Detail: ${trans.desc}`, `
        <div class="space-y-4">
            <div class="flex justify-between items-center">
                <span class="text-gray-600">Jumlah</span>
                <span class="text-xl font-bold ${trans.type === 'income' ? 'text-green-600' : 'text-red-500'}">
                    ${trans.type === 'income' ? '+' : '-'}Rp ${formatCurrency(trans.amount)}
                </span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Kategori</span>
                <span class="font-medium">${trans.category}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Tanggal</span>
                <span class="font-medium">${trans.date}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Jenis</span>
                <span class="font-medium">${trans.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}</span>
            </div>
        </div>
    `, {
        confirm: true,
        confirmText: 'Edit',
        cancelText: 'Hapus',
        confirmAction: `editTransaction(${id})`
    });
}

function editTransaction(id) {
    showToast('Fitur edit transaksi sedang dikembangkan', 'info');
    closeCurrentModal();
}

function showQuickStats() {
    const income = appState.transactions.filter(t => t.type === 'income')
                 .reduce((sum, t) => sum + t.amount, 0);
    const expense = appState.transactions.filter(t => t.type === 'expense')
                  .reduce((sum, t) => sum + t.amount, 0);
    
    showModal('Statistik Cepat', `
        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-green-50 p-4 rounded-xl">
                    <p class="text-xs text-green-700">Total Pemasukan</p>
                    <p class="text-lg font-bold text-green-800">Rp ${formatCurrency(income)}</p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl">
                    <p class="text-xs text-red-700">Total Pengeluaran</p>
                    <p class="text-lg font-bold text-red-800">Rp ${formatCurrency(expense)}</p>
                </div>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl">
                <p class="text-xs text-blue-700">Saldo Saat Ini</p>
                <p class="text-lg font-bold text-blue-800">Rp ${formatCurrency(income - expense)}</p>
            </div>
            <div class="bg-purple-50 p-4 rounded-xl">
                <p class="text-xs text-purple-700">Transaksi Bulan Ini</p>
                <p class="text-lg font-bold text-purple-800">${appState.transactions.length}</p>
            </div>
        </div>
    `);
}

function showTransactionFilters() {
    showModal('Filter Transaksi', `
        <div class="space-y-3">
            <button onclick="applyFilter('all')" class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50 btn-press">
                Semua Transaksi
            </button>
            <button onclick="applyFilter('income')" class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50 btn-press">
                Hanya Pemasukan
            </button>
            <button onclick="applyFilter('expense')" class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50 btn-press">
                Hanya Pengeluaran
            </button>
            <button onclick="applyFilter('today')" class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50 btn-press">
                Hari Ini Saja
            </button>
        </div>
    `);
}

function applyFilter(type) {
    showToast(`Filter "${type}" diterapkan`, 'info');
    closeCurrentModal();
}

function showTodayTransactions() {
    const today = new Date().toISOString().split('T')[0];
    const todayTrans = appState.transactions.filter(t => t.date === today);
    
    if (todayTrans.length === 0) {
        showModal('Transaksi Hari Ini', `
            <div class="text-center py-8">
                <i class="fa-solid fa-calendar-check text-4xl text-gray-300 mb-3"></i>
                <p class="text-gray-600">Belum ada transaksi hari ini</p>
            </div>
        `);
    } else {
        showModal('Transaksi Hari Ini', `
            <div class="space-y-3">
                ${todayTrans.map(trans => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">${trans.desc}</p>
                            <p class="text-sm text-gray-500">${trans.category}</p>
                        </div>
                        <span class="font-bold ${trans.type === 'income' ? 'text-green-600' : 'text-red-500'}">
                            ${trans.type === 'income' ? '+' : '-'}Rp ${formatCurrency(trans.amount)}
                        </span>
                    </div>
                `).join('')}
            </div>
        `);
    }
}

function showBalanceDetail() {
    showModal('Detail Saldo', `
        <div class="space-y-4">
            <div class="bg-gradient-to-r from-adamon-dark to-teal-700 p-5 rounded-xl text-white">
                <p class="text-teal-100 text-sm mb-2">Saldo Tersedia</p>
                <p class="text-3xl font-bold">Rp ${formatCurrency(appState.user.balance)}</p>
            </div>
            
            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Saldo Awal Bulan</span>
                    <span class="font-medium">Rp 28.000.000</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Total Pemasukan</span>
                    <span class="font-medium text-green-600">+ Rp ${formatCurrency(appState.financialData.income)}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Total Pengeluaran</span>
                    <span class="font-medium text-red-600">- Rp ${formatCurrency(appState.financialData.expense)}</span>
                </div>
            </div>
            
            <div class="pt-4 border-t border-gray-200">
                <p class="text-sm font-medium text-gray-800 mb-2">Perubahan Saldo:</p>
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-arrow-trend-up text-green-500"></i>
                    <span class="text-green-600 font-medium">+22% dari bulan lalu</span>
                </div>
            </div>
        </div>
    `);
}

function exportFinancialReport() {
    showToast('Mengekspor laporan keuangan...', 'info');
    setTimeout(() => {
        showToast('Laporan berhasil diunduh!', 'success');
    }, 1500);
}

// ============================================
// SETUP EVENT LISTENERS
// ============================================

function setupEventListeners() {
    // Add ripple effect to all buttons
    document.addEventListener('click', function(e) {
        if (e.target.closest('.btn-press')) {
            const btn = e.target.closest('.btn-press');
            btn.classList.add('active:scale-95');
            
            // Remove scale class after animation
            setTimeout(() => {
                btn.classList.remove('active:scale-95');
            }, 200);
        }
    });
}

// ============================================
// INITIALIZE APP
// ============================================

document.addEventListener('DOMContentLoaded', initApp);
